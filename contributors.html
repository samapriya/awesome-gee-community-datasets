<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Awesome GEE Community Leaderboard</title>

    <!-- Fonts: Inter, JetBrains Mono, Montserrat -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&family=Montserrat:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <!-- Material Symbols -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-G7SXDJEWXV"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-G7SXDJEWXV');
    </script>

    <!-- Import Map -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client?deps=react@18.2.0",
            "framer-motion": "https://esm.sh/framer-motion@10.16.4?deps=react@18.2.0,react-dom@18.2.0"
        }
    }
    </script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                        heading: ['Montserrat', 'sans-serif'],
                    },
                    colors: {
                        slate: {
                            850: '#151e2e',
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f8fafc;
            color: #0f172a;
            font-family: "Inter", sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .dark body {
            background-color: #0b1120;
            color: #f1f5f9;
        }

        /* Glassmorphism Utilities */
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .dark .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .glass-sticky {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.6);
        }

        .dark .glass-sticky {
            background: rgba(15, 23, 42, 0.85);
            border-bottom: 1px solid rgba(51, 65, 85, 0.5);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useMemo, useEffect, Component } from 'react';
        import { createRoot } from 'react-dom/client';
        import { motion, AnimatePresence } from 'framer-motion';

        // --- Error Boundary ---
        class ErrorBoundary extends Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }
            static getDerivedStateFromError(error) { return { hasError: true, error }; }
            componentDidCatch(error, errorInfo) { console.error("React Error:", error, errorInfo); }
            render() {
                if (this.state.hasError) return (
                    <div className="min-h-screen flex items-center justify-center bg-red-50 text-red-900 p-8">
                        <div className="max-w-lg text-center">
                            <h1 className="text-2xl font-bold mb-4">Something went wrong.</h1>
                            <div className="bg-white p-4 rounded shadow text-left overflow-auto text-xs font-mono border border-red-200">{this.state.error?.toString()}</div>
                        </div>
                    </div>
                );
                return this.props.children;
            }
        }

        // --- Skeleton Loader ---
        const SkeletonCard = () => (
            <div className="rounded-2xl p-6 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 shadow-sm animate-pulse">
                <div className="flex items-center gap-4 mb-6">
                    <div className="w-16 h-16 rounded-full bg-slate-200 dark:bg-slate-700"></div>
                    <div className="flex-1">
                        <div className="h-5 bg-slate-200 dark:bg-slate-700 rounded w-3/4 mb-2"></div>
                        <div className="h-3 bg-slate-200 dark:bg-slate-700 rounded w-1/3"></div>
                    </div>
                </div>
                <div className="h-8 bg-slate-100 dark:bg-slate-700/50 rounded mb-4"></div>
                <div className="grid grid-cols-2 gap-4">
                    <div className="h-12 bg-slate-100 dark:bg-slate-700/50 rounded"></div>
                    <div className="h-12 bg-slate-100 dark:bg-slate-700/50 rounded"></div>
                </div>
            </div>
        );

        // --- Components ---

        const Hero = ({ totalContributors, totalContributions, repoStats }) => {
            const repoStatItems = repoStats ? [
                { label: "Stars", value: repoStats.total_stars, icon: "star", color: "text-amber-500" },
                { label: "Forks", value: repoStats.total_forks, icon: "call_split", color: "text-blue-500" },
                { label: "Issues", value: repoStats.open_issues, icon: "adjust", color: "text-rose-500" },
                { label: "PRs", value: repoStats.total_prs, icon: "merge_type", color: "text-violet-500" }
            ] : [];

            return (
                <div className="relative pt-20 pb-16 overflow-hidden">
                    {/* Background decoration */}
                    <div className="absolute inset-0 bg-gradient-to-br from-blue-50/50 via-white to-purple-50/50 dark:from-slate-900 dark:via-slate-900 dark:to-slate-800 -z-10"></div>
                    <div className="absolute top-0 right-0 -mr-20 -mt-20 w-96 h-96 bg-blue-100 dark:bg-blue-900/20 rounded-full blur-3xl opacity-50"></div>
                    
                    <div className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center z-10">
                        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.8 }}>
                            <div className="inline-block p-3 rounded-2xl bg-white dark:bg-slate-800 shadow-sm mb-6">
                                <img src="https://i.imgur.com/FYPcTFF.png" alt="Awesome GEE Logo" className="h-16 w-auto" />
                            </div>
                            <h1 className="text-4xl md:text-6xl font-black tracking-tight text-slate-900 dark:text-white mb-4 font-heading">
                                Community <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-violet-600">Leaderboard</span>
                            </h1>
                            <p className="mt-4 text-xl text-slate-600 dark:text-slate-300 max-w-2xl mx-auto font-light leading-relaxed">
                                Celebrating the minds behind the <span className="font-semibold text-slate-800 dark:text-slate-200">Awesome GEE Community Catalog</span>.
                            </p>
                        </motion.div>

                        <motion.div 
                            initial={{ opacity: 0 }} 
                            animate={{ opacity: 1 }} 
                            transition={{ delay: 0.3 }}
                            className="mt-10 flex flex-wrap justify-center gap-4"
                        >
                            {/* Main Stats Pills */}
                            <div className="glass-panel px-6 py-3 rounded-full flex items-center gap-3 shadow-sm hover:shadow-md transition-shadow">
                                <span className="text-2xl font-black text-slate-800 dark:text-white font-mono">{totalContributors || '...'}</span>
                                <span className="text-sm font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">Contributors</span>
                            </div>
                            <div className="glass-panel px-6 py-3 rounded-full flex items-center gap-3 shadow-sm hover:shadow-md transition-shadow">
                                <span className="text-2xl font-black text-slate-800 dark:text-white font-mono">{totalContributions || '...'}</span>
                                <span className="text-sm font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">Contributions</span>
                            </div>
                        </motion.div>

                        {/* Repo Stats Row */}
                        <motion.div 
                            initial={{ opacity: 0 }} 
                            animate={{ opacity: 1 }} 
                            transition={{ delay: 0.5 }}
                            className="mt-8 flex flex-wrap justify-center gap-6 text-sm"
                        >
                            {repoStatItems.map((item) => (
                                <div key={item.label} className="flex items-center gap-2 text-slate-600 dark:text-slate-400 bg-white/50 dark:bg-slate-800/50 px-3 py-1.5 rounded-lg border border-slate-200/50 dark:border-slate-700/50">
                                    <span className={`material-symbols-rounded text-[20px] ${item.color}`}>{item.icon}</span>
                                    <span className="font-bold text-slate-900 dark:text-white font-mono">{item.value}</span>
                                    <span>{item.label}</span>
                                </div>
                            ))}
                        </motion.div>
                    </div>
                </div>
            );
        };

        const StatRow = ({ icon, label, val1, label1, val2, label2, colorClass }) => (
            <div className="flex items-center justify-between p-3 rounded-lg bg-slate-50 dark:bg-slate-800/50 border border-slate-100 dark:border-slate-700/50 group-hover:border-slate-200 dark:group-hover:border-slate-600 transition-colors">
                <div className="flex items-center gap-3">
                    <div className={`p-1.5 rounded-md ${colorClass} bg-opacity-10`}>
                        <span className={`material-symbols-rounded text-[18px] ${colorClass.replace('bg-', 'text-')}`}>{icon}</span>
                    </div>
                    <div className="flex flex-col">
                        <span className="text-[10px] font-bold uppercase tracking-wider text-slate-400 dark:text-slate-500">{label}</span>
                        <div className="flex gap-3 text-xs font-medium text-slate-700 dark:text-slate-300">
                             <span><span className="font-bold font-mono text-slate-900 dark:text-white">{val1}</span> {label1}</span>
                             <span className="text-slate-300 dark:text-slate-600">|</span>
                             <span><span className="font-bold font-mono text-slate-900 dark:text-white">{val2}</span> {label2}</span>
                        </div>
                    </div>
                </div>
            </div>
        );

        const ContributorCard = ({ user, count, label }) => {
            return (
                <motion.div
                    layout
                    initial={{ opacity: 0, scale: 0.95 }}
                    animate={{ opacity: 1, scale: 1 }}
                    exit={{ opacity: 0, scale: 0.95 }}
                    whileHover={{ y: -4, transition: { duration: 0.2 } }}
                    className="group relative flex flex-col justify-between p-6 bg-white dark:bg-slate-800 rounded-2xl shadow-sm hover:shadow-xl border border-slate-200 dark:border-slate-700 transition-all duration-300"
                >
                    {/* Header */}
                    <div className="flex items-start justify-between mb-6">
                        <div className="flex gap-4">
                            <a href={user.profile_url} target="_blank" rel="noopener noreferrer" className="relative">
                                <img
                                    src={user.avatar_url}
                                    alt={user.github_login}
                                    className="w-16 h-16 rounded-2xl object-cover border-2 border-white dark:border-slate-700 shadow-sm group-hover:scale-105 transition-transform"
                                    onError={(e) => { e.target.onerror = null; e.target.src = "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" }}
                                />
                                <div className="absolute -bottom-2 -right-2 bg-white dark:bg-slate-800 rounded-lg p-1 shadow-sm border border-slate-100 dark:border-slate-700">
                                    <span className="block text-xs font-black text-center min-w-[24px] text-blue-600 dark:text-blue-400 font-mono">
                                        {count}
                                    </span>
                                </div>
                            </a>
                            <div className="flex flex-col justify-center">
                                <a href={user.profile_url} target="_blank" rel="noopener noreferrer" className="hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
                                    <h3 className="text-lg font-bold text-slate-900 dark:text-white font-heading leading-tight line-clamp-1">
                                        {user.display_name || user.github_login}
                                    </h3>
                                </a>
                                <p className="text-xs font-medium text-slate-500 dark:text-slate-400 font-mono">@{user.github_login}</p>
                            </div>
                        </div>
                    </div>

                    {/* Stats */}
                    <div className="space-y-2 mb-4">
                        <StatRow 
                            icon="adjust" 
                            label="Issues"
                            val1={user.open_issues || 0} label1="Open"
                            val2={user.closed_issues || 0} label2="Closed"
                            colorClass="bg-emerald-500 text-emerald-600"
                        />
                        <StatRow 
                            icon="call_split" 
                            label="Pull Requests"
                            val1={user.open_prs || 0} label1="Open"
                            val2={user.merged_prs || 0} label2="Merged"
                            colorClass="bg-violet-500 text-violet-600"
                        />
                    </div>

                    {/* Footer */}
                    <div className="pt-4 mt-auto border-t border-slate-100 dark:border-slate-700 flex justify-between items-center text-xs">
                         <span className="font-semibold text-slate-400 dark:text-slate-500 font-mono uppercase tracking-wider">Last Active</span>
                         <span className="font-medium text-slate-600 dark:text-slate-300">
                             {user.last_contribution_date 
                                ? new Date(user.last_contribution_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) 
                                : 'N/A'}
                         </span>
                    </div>
                </motion.div>
            );
        };

        const App = () => {
            const [contributorsData, setContributorsData] = useState([]);
            const [repoStats, setRepoStats] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedYear, setSelectedYear] = useState('All Time');
            const [sortType, setSortType] = useState('count');
            const [darkMode, setDarkMode] = useState(false);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const fetchJson = async (url) => {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response.json();
                };

                Promise.all([
                    fetchJson('https://raw.githubusercontent.com/samapriya/awesome-gee-community-datasets/master/issues-summary.json'),
                    fetchJson('https://api.github.com/repos/samapriya/awesome-gee-community-datasets/issues?state=all&per_page=100'),
                    fetchJson('https://raw.githubusercontent.com/samapriya/awesome-gee-community-datasets/master/repo-stats.json')
                ]).then(([summary, issues, stats]) => {
                    setRepoStats(stats);
                    const yearlyData = {};
                    if (Array.isArray(issues)) {
                        issues.forEach(issue => {
                            const user = issue.user.login;
                            const year = new Date(issue.created_at).getFullYear().toString();
                            if (!yearlyData[user]) yearlyData[user] = {};
                            if (!yearlyData[user][year]) yearlyData[user][year] = 0;
                            yearlyData[user][year]++;
                        });
                    }
                    const mergedData = summary.map(user => ({
                        ...user,
                        years: yearlyData[user.github_login] || {}
                    }));
                    setContributorsData(mergedData);
                    setLoading(false);
                }).catch(err => {
                    console.error("Failed to fetch data", err);
                    setLoading(false);
                });
            }, []);

            useEffect(() => {
                if (darkMode) document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
            }, [darkMode]);

            const availableYears = useMemo(() => {
                const years = new Set();
                contributorsData.forEach(user => {
                    if (user.years) Object.keys(user.years).forEach(y => years.add(y));
                });
                return ['All Time', ...Array.from(years).sort().reverse()];
            }, [contributorsData]);

            const filteredData = useMemo(() => {
                let data = contributorsData.map(user => {
                    let count = selectedYear === 'All Time' ? user.total_contributions : (user.years?.[selectedYear] || 0);
                    return { ...user, currentCount: count };
                });
                data = data.filter(u => u.currentCount > 0);
                if (searchTerm) {
                    const lowerTerm = searchTerm.toLowerCase();
                    data = data.filter(u =>
                        (u.github_login?.toLowerCase().includes(lowerTerm)) ||
                        (u.display_name?.toLowerCase().includes(lowerTerm))
                    );
                }
                data.sort((a, b) => {
                    if (sortType === 'count') return b.currentCount - a.currentCount || (a.display_name || '').localeCompare(b.display_name || '');
                    if (sortType === 'az') return (a.display_name || a.github_login).localeCompare(b.display_name || b.github_login);
                    if (sortType === 'recent') return new Date(b.last_contribution_date) - new Date(a.last_contribution_date);
                    return 0;
                });
                return data;
            }, [contributorsData, searchTerm, selectedYear, sortType]);

            return (
                <div className="min-h-screen dark:bg-slate-900 transition-colors duration-300">
                    <Hero totalContributors={contributorsData.length} totalContributions={contributorsData.reduce((acc, curr) => acc + curr.total_contributions, 0)} repoStats={repoStats} />

                    {/* Sticky Controls Bar */}
                    <div className="sticky top-0 z-40 glass-sticky transition-colors duration-300">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                            <div className="flex flex-col lg:flex-row gap-4 items-center justify-between">
                                {/* Search */}
                                <div className="relative w-full lg:w-80 group">
                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <span className="material-symbols-rounded text-slate-400 group-focus-within:text-blue-500 transition-colors">search</span>
                                    </div>
                                    <input
                                        type="text"
                                        className="block w-full pl-10 pr-3 py-2.5 bg-slate-100 dark:bg-slate-800 border-none rounded-xl text-slate-900 dark:text-white placeholder-slate-500 focus:ring-2 focus:ring-blue-500 focus:bg-white dark:focus:bg-slate-800 transition-all font-sans text-sm"
                                        placeholder="Find a contributor..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                    />
                                </div>

                                {/* Filters Row */}
                                <div className="flex items-center gap-3 overflow-x-auto w-full lg:w-auto pb-1 scrollbar-hide">
                                    {/* Year */}
                                    <div className="flex bg-slate-100 dark:bg-slate-800 p-1 rounded-xl">
                                        {availableYears.map(year => (
                                            <button
                                                key={year}
                                                onClick={() => setSelectedYear(year)}
                                                className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-all whitespace-nowrap ${selectedYear === year ? 'bg-white dark:bg-slate-700 text-blue-600 dark:text-blue-400 shadow-sm' : 'text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white'}`}
                                            >
                                                {year}
                                            </button>
                                        ))}
                                    </div>

                                    <div className="w-px h-8 bg-slate-200 dark:bg-slate-700 mx-1"></div>

                                    {/* Sort */}
                                    <div className="flex bg-slate-100 dark:bg-slate-800 p-1 rounded-xl">
                                        {[
                                            { id: 'count', label: 'Activity' },
                                            { id: 'recent', label: 'Recent' },
                                            { id: 'az', label: 'A-Z' }
                                        ].map(sort => (
                                            <button
                                                key={sort.id}
                                                onClick={() => setSortType(sort.id)}
                                                className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-all whitespace-nowrap ${sortType === sort.id ? 'bg-white dark:bg-slate-700 text-blue-600 dark:text-blue-400 shadow-sm' : 'text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white'}`}
                                            >
                                                {sort.label}
                                            </button>
                                        ))}
                                    </div>
                                    
                                    <div className="w-px h-8 bg-slate-200 dark:bg-slate-700 mx-1"></div>

                                    {/* Dark Mode Toggle */}
                                    <button
                                        onClick={() => setDarkMode(!darkMode)}
                                        className="p-2.5 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors"
                                    >
                                        <span className="material-symbols-rounded text-[20px]">{darkMode ? 'light_mode' : 'dark_mode'}</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {/* Leaderboard Grid */}
                        <motion.div layout className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                            <AnimatePresence>
                                {loading ? (
                                    // Skeleton Loading State
                                    [...Array(8)].map((_, i) => <SkeletonCard key={i} />)
                                ) : filteredData.length > 0 ? (
                                    filteredData.map((user) => (
                                        <ContributorCard
                                            key={user.github_login}
                                            user={user}
                                            count={user.currentCount}
                                            label={selectedYear === 'All Time' ? 'Total' : `in ${selectedYear}`}
                                        />
                                    ))
                                ) : (
                                    <div className="col-span-full py-20 text-center">
                                        <div className="inline-flex items-center justify-center w-16 h-16 rounded-full bg-slate-100 dark:bg-slate-800 mb-4">
                                            <span className="material-symbols-rounded text-slate-400 text-3xl">search_off</span>
                                        </div>
                                        <h3 className="text-lg font-bold text-slate-900 dark:text-white">No contributors found</h3>
                                        <p className="text-slate-500 dark:text-slate-400">Try adjusting your search or filters.</p>
                                    </div>
                                )}
                            </AnimatePresence>
                        </motion.div>
                    </div>

                    <footer className="text-center text-slate-400 dark:text-slate-500 text-xs py-10 font-mono">
                        <p>Data provided by Awesome GEE Community Catalog.</p>
                        <p className="mt-2 flex items-center justify-center gap-1">Built with <span className="text-red-500">‚ù§</span> for the GEE Community</p>
                    </footer>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<ErrorBoundary><App /></ErrorBoundary>);
    </script>
</body>
</html>
