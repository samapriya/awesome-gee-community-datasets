<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Awesome GEE Community Leaderboard</title>

    <!-- Fonts: Afacad Flux & Roboto -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Afacad+Flux:wght@100..1000&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-G7SXDJEWXV"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-G7SXDJEWXV');
    </script>

    <!-- Import Map -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "framer-motion": "https://esm.sh/framer-motion@10.16.4?deps=react@18.2.0,react-dom@18.2.0"
        }
    }
    </script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Afacad Flux"', 'sans-serif'],
                        roboto: ['Roboto', 'sans-serif'],
                    },
                    colors: {
                        gray: {
                            50: '#f9fafb',
                            100: '#f3f4f6',
                            800: '#1f2937',
                            900: '#111827',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            /* Use slightly off-white for less harshness in light mode */
            background-color: #f1f3f5;
            color: #1f2937;
            font-family: "Afacad Flux", sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .dark body {
            background-color: #111827;
            color: #f9fafb;
        }

        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            transition: all 0.3s ease;
        }

        .card-shadow:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #4b5563;
        }

        .dark ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useMemo, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { motion, AnimatePresence } from 'framer-motion';

        // --- Components ---

        const Hero = ({ totalContributors, totalContributions }) => {
            return (
                <div className="relative overflow-hidden bg-white dark:bg-gray-900 py-12 sm:py-16 border-b border-gray-200 dark:border-gray-800 transition-colors duration-300">
                    <div className="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                        <img src="https://i.imgur.com/FYPcTFF.png" alt="Awesome GEE Community Catalog"
                            className="mx-auto h-20 w-auto mb-6" />
                        <motion.div
                            initial={{ opacity: 0, y: 20 }}
                            animate={{ opacity: 1, y: 0 }}
                            transition={{ duration: 0.8 }}
                        >
                            <h1 className="text-4xl sm:text-5xl lg:text-6xl font-extrabold tracking-tight text-gray-900 dark:text-white mb-4 transition-colors duration-300">
                                Community Leaderboard
                            </h1>
                            <p className="mt-4 text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto font-roboto transition-colors duration-300">
                                Celebrating the contributors who make the dataset catalog possible.
                            </p>
                        </motion.div>

                        <motion.div
                            initial={{ opacity: 0 }}
                            animate={{ opacity: 1 }}
                            transition={{ delay: 0.5, duration: 0.8 }}
                            className="mt-8 flex justify-center gap-4 flex-wrap"
                        >
                            <div className="px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-full border border-gray-200 dark:border-gray-700 text-sm font-medium text-gray-700 dark:text-gray-200 font-roboto transition-colors duration-300">
                                <span className="text-green-600 dark:text-green-400 font-bold">{totalContributors}</span> Contributors
                            </div>
                            <div className="px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-full border border-gray-200 dark:border-gray-700 text-sm font-medium text-gray-700 dark:text-gray-200 font-roboto transition-colors duration-300">
                                <span className="text-blue-600 dark:text-blue-400 font-bold">{totalContributions}</span> Total Contributions
                            </div>
                        </motion.div>
                    </div>
                </div>
            );
        };

        const ContributorCard = ({ user, count, label }) => {
            return (
                <motion.div
                    layout
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                    exit={{ opacity: 0, scale: 0.9 }}
                    whileHover={{ y: -5, transition: { duration: 0.2 } }}
                    className="relative group rounded-xl p-5 border bg-white dark:bg-gray-800 border-gray-100 dark:border-gray-700 hover:border-gray-200 dark:hover:border-gray-600 hover:shadow-md card-shadow transition-all duration-300"
                >
                    <div className="flex items-center space-x-4">
                        <div className="relative">
                            <a href={user.profile_url} target="_blank" rel="noopener noreferrer">
                                <img
                                    src={user.avatar_url}
                                    alt={user.github_login}
                                    className="w-16 h-16 rounded-full border-2 border-gray-200 dark:border-gray-700 object-cover group-hover:border-blue-500 transition-colors bg-white dark:bg-gray-700"
                                    onError={(e) => { e.target.onerror = null; e.target.src = "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" }}
                                />
                            </a>
                        </div>

                        <div className="flex-1 min-w-0">
                            <a href={user.profile_url} target="_blank" rel="noopener noreferrer" className="hover:underline decoration-blue-500">
                                <h3 className="text-lg font-bold text-gray-900 dark:text-white truncate transition-colors duration-300">
                                    {user.display_name || user.github_login}
                                </h3>
                                {user.display_name && (
                                    <p className="text-xs text-gray-500 dark:text-gray-400 truncate font-roboto transition-colors duration-300">@{user.github_login}</p>
                                )}
                            </a>
                            <div className="mt-2 flex items-center">
                                <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 transition-colors duration-300">
                                    {count} {label}
                                </span>
                            </div>
                        </div>
                    </div>

                    <div className="mt-4 flex gap-2 text-xs font-roboto">
                        <div className="flex-1 bg-gray-50 dark:bg-gray-700 rounded p-2 text-center border border-gray-200 dark:border-gray-600 transition-colors duration-300">
                            <span className="block text-green-600 dark:text-green-400 font-bold">{user.open_issues || 0}</span>
                            <span className="text-gray-500 dark:text-gray-400">Open</span>
                        </div>
                        <div className="flex-1 bg-gray-50 dark:bg-gray-700 rounded p-2 text-center border border-gray-200 dark:border-gray-600 transition-colors duration-300">
                            <span className="block text-purple-600 dark:text-purple-400 font-bold">{user.closed_issues || 0}</span>
                            <span className="text-gray-500 dark:text-gray-400">Closed</span>
                        </div>
                    </div>

                    <div className="mt-3 text-xs text-gray-400 dark:text-gray-500 text-right font-roboto transition-colors duration-300">
                        Last Active: {user.last_contribution_date ? new Date(user.last_contribution_date).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) : 'N/A'}
                    </div>
                </motion.div>
            );
        };

        const App = () => {
            const [contributorsData, setContributorsData] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedYear, setSelectedYear] = useState('All Time');
            const [sortType, setSortType] = useState('count'); // 'count', 'az', 'za', 'recent'
            const [darkMode, setDarkMode] = useState(false);
            const [loading, setLoading] = useState(true);

            // Fetch Data
            useEffect(() => {
                Promise.all([
                    fetch('https://raw.githubusercontent.com/samapriya/awesome-gee-community-datasets/refs/heads/master/issues-summary.json').then(res => res.json()),
                    fetch('https://api.github.com/repos/samapriya/awesome-gee-community-datasets/issues?state=all&per_page=100').then(res => res.json()) // Note: Using GitHub API directly might hit rate limits. Better to use your own processed JSON if possible.
                    // If you have a processed issues.json like you uploaded, use that URL instead.
                    // For now, I'll simulate the yearly processing based on the issues.json structure you shared.
                    // Assuming you host issues.json at a URL, replace the second fetch above.
                ])
                    .then(([summary, issues]) => {
                        // Process issues to calculate yearly stats per user
                        const yearlyData = {};

                        // Note: If 'issues' is the raw array of issue objects:
                        issues.forEach(issue => {
                            const user = issue.user.login;
                            const date = new Date(issue.created_at);
                            const year = date.getFullYear().toString();

                            if (!yearlyData[user]) yearlyData[user] = {};
                            if (!yearlyData[user][year]) yearlyData[user][year] = 0;
                            yearlyData[user][year]++;
                        });

                        // Merge yearly data into summary data
                        const mergedData = summary.map(user => ({
                            ...user,
                            years: yearlyData[user.github_login] || {}
                        }));

                        setContributorsData(mergedData);
                        setLoading(false);
                    })
                    .catch(err => {
                        console.error("Failed to fetch data", err);
                        setLoading(false);
                    });
            }, []);

            useEffect(() => {
                if (darkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [darkMode]);

            // Extract available years from data
            const availableYears = useMemo(() => {
                const years = new Set();
                contributorsData.forEach(user => {
                    if (user.years) {
                        Object.keys(user.years).forEach(y => years.add(y));
                    }
                });
                return ['All Time', ...Array.from(years).sort().reverse()];
            }, [contributorsData]);

            // Memoize filtered and sorted data
            const filteredData = useMemo(() => {
                let data = contributorsData.map(user => {
                    // Calculate count based on selected year
                    let count = 0;
                    if (selectedYear === 'All Time') {
                        count = user.total_contributions;
                    } else {
                        count = user.years && user.years[selectedYear] ? user.years[selectedYear] : 0;
                    }
                    return { ...user, currentCount: count };
                });

                // Filter out users with 0 contributions for the selected year
                data = data.filter(u => u.currentCount > 0);

                // Filter by search term
                if (searchTerm) {
                    const lowerTerm = searchTerm.toLowerCase();
                    data = data.filter(u =>
                        (u.github_login && u.github_login.toLowerCase().includes(lowerTerm)) ||
                        (u.display_name && u.display_name.toLowerCase().includes(lowerTerm))
                    );
                }

                // Sort
                data.sort((a, b) => {
                    if (sortType === 'count') {
                        if (b.currentCount !== a.currentCount) {
                            return b.currentCount - a.currentCount;
                        }
                        // Secondary sort by name
                        return (a.display_name || a.github_login).localeCompare(b.display_name || b.github_login);
                    } else if (sortType === 'az') {
                        const nameA = a.display_name || a.github_login;
                        const nameB = b.display_name || b.github_login;
                        return nameA.localeCompare(nameB);
                    } else if (sortType === 'za') {
                        const nameA = a.display_name || a.github_login;
                        const nameB = b.display_name || b.github_login;
                        return nameB.localeCompare(nameA);
                    } else if (sortType === 'recent') {
                        return new Date(b.last_contribution_date) - new Date(a.last_contribution_date);
                    }
                    return 0;
                });

                return data;
            }, [contributorsData, searchTerm, selectedYear, sortType]);

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center dark:bg-gray-900 transition-colors duration-300">
                        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen pb-20 dark:bg-gray-900 transition-colors duration-300">
                    <div className="absolute top-4 right-4 z-50">
                        <button
                            onClick={() => setDarkMode(!darkMode)}
                            className="p-2 rounded-full bg-white dark:bg-gray-800 text-gray-800 dark:text-white shadow-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                            aria-label="Toggle Dark Mode"
                        >
                            {darkMode ? (
                                <span className="material-symbols-outlined">light_mode</span>
                            ) : (
                                <span className="material-symbols-outlined">dark_mode</span>
                            )}
                        </button>
                    </div>

                    <Hero
                        totalContributors={contributorsData.length}
                        totalContributions={contributorsData.reduce((acc, curr) => acc + curr.total_contributions, 0)}
                    />

                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 -mt-8 relative z-20">
                        {/* Controls Bar */}
                        <div className="bg-white dark:bg-gray-800 rounded-xl p-4 mb-8 flex flex-col lg:flex-row gap-4 items-center justify-between shadow-lg border border-gray-100 dark:border-gray-700 transition-colors duration-300">

                            {/* Search */}
                            <div className="relative w-full lg:w-96">
                                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <span className="material-symbols-outlined text-gray-400">search</span>
                                </div>
                                <input
                                    type="text"
                                    className="block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg leading-5 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 sm:text-sm transition-colors font-roboto"
                                    placeholder="Search contributors..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                />
                            </div>

                            {/* Center: Year Filter */}
                            <div className="flex items-center gap-2 overflow-x-auto max-w-full lg:max-w-md pb-2 lg:pb-0 scrollbar-hide">
                                <span className="text-sm font-medium text-gray-600 dark:text-gray-300 font-roboto whitespace-nowrap">Time Period:</span>
                                <div className="flex bg-gray-100 dark:bg-gray-700 p-1 rounded-lg border border-gray-200 dark:border-gray-600">
                                    {availableYears.map(year => (
                                        <button
                                            key={year}
                                            onClick={() => setSelectedYear(year)}
                                            className={`px-3 py-1.5 rounded-md text-sm font-medium transition-all whitespace-nowrap font-roboto ${selectedYear === year ? 'bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm' : 'text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white'}`}
                                        >
                                            {year}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Right: Sort Buttons */}
                            <div className="flex bg-gray-100 dark:bg-gray-700 p-1 rounded-lg border border-gray-200 dark:border-gray-600 overflow-x-auto max-w-full pb-2 lg:pb-0 scrollbar-hide">
                                <button
                                    onClick={() => setSortType('count')}
                                    className={`px-3 py-1.5 rounded-md text-sm font-medium transition-all whitespace-nowrap font-roboto ${sortType === 'count' ? 'bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm' : 'text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white'}`}
                                >
                                    Most Issues
                                </button>
                                <button
                                    onClick={() => setSortType('recent')}
                                    className={`px-3 py-1.5 rounded-md text-sm font-medium transition-all whitespace-nowrap font-roboto ${sortType === 'recent' ? 'bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm' : 'text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white'}`}
                                >
                                    Most Recent
                                </button>
                                <button
                                    onClick={() => setSortType('az')}
                                    className={`px-3 py-1.5 rounded-md text-sm font-medium transition-all whitespace-nowrap font-roboto ${sortType === 'az' ? 'bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm' : 'text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white'}`}
                                >
                                    A-Z
                                </button>
                            </div>
                        </div>

                        {/* Leaderboard Grid */}
                        <motion.div
                            layout
                            className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
                        >
                            <AnimatePresence>
                                {filteredData.map((user, index) => {
                                    return (
                                        <ContributorCard
                                            key={user.github_login}
                                            user={user}
                                            count={user.currentCount}
                                            label={selectedYear === 'All Time' ? 'Total' : `in ${selectedYear}`}
                                        />
                                    );
                                })}
                            </AnimatePresence>
                        </motion.div>

                        {filteredData.length === 0 && (
                            <div className="text-center py-20 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 transition-colors duration-300">
                                <p className="text-gray-500 dark:text-gray-400 text-lg font-roboto">No contributors found matching criteria.</p>
                            </div>
                        )}
                    </div>

                    <footer className="mt-20 text-center text-gray-500 dark:text-gray-400 text-sm pb-8 font-roboto transition-colors duration-300">
                        <p>Data provided by Awesome GEE Community Catalog.</p>
                        <p className="mt-2">Built with ❤️ for the GEE Community</p>
                    </footer>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>
